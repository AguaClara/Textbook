

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Flow Control and Measurement Derivations &mdash; AguaClara Textbook  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Flow Control and Measurement Solution" href="FCM_Solution.html" />
    <link rel="prev" title="Flow Control and Measurement Design" href="FCM_Design.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> AguaClara Textbook
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Acknowledgements</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Authors.html">Authors</a></li>
</ul>
<p class="caption"><span class="caption-text">Chapter 1: Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction/Introduction.html">Introduction to AguaClara Water Treatment Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Introduction/Python_Tutorial.html">Python Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Chapter 2: Review: Fluid Mechanics and Python</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Review/Review_Fluid_Mechanics.html">Review: Fluid Mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Review/Review_Fluid_Mechanics_Derivations.html">Review: Fluid Mechanics Derivations</a></li>
</ul>
<p class="caption"><span class="caption-text">Chapter 3: Flow Control and Measurement</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="FCM_Intro.html">Flow Control and Measurement Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="FCM_Design.html">Flow Control and Measurement Design</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Flow Control and Measurement Derivations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#for-a-tank-with-a-valve"><span class="math notranslate nohighlight">\(Q\left(t\right)\)</span> for a Tank with a Valve</a></li>
<li class="toctree-l2"><a class="reference internal" href="#and-for-tank-drain-equation"><span class="math notranslate nohighlight">\(D(t)\)</span> and <span class="math notranslate nohighlight">\(t(D)\)</span> for Tank Drain Equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#design-equations-for-the-linear-chemical-dose-controller-cdc">Design Equations for the Linear Chemical Dose Controller (CDC)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cdc-design-equation-derivation">CDC Design Equation Derivation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#designing-for-the-error-constraint">Designing for the error constraint, <span class="math notranslate nohighlight">\(\Pi_{Error}\)</span></a></li>
<li class="toctree-l4"><a class="reference internal" href="#designing-for-the-proper-amount-of-head-loss">Designing for the proper amount of head loss, <span class="math notranslate nohighlight">\(h_{L_{Max}}\)</span></a></li>
<li class="toctree-l4"><a class="reference internal" href="#cdc-dosing-tube-s-diameter-plots">CDC Dosing Tube(s) Diameter <span class="math notranslate nohighlight">\(D_{Min}\)</span> Plots</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#lfom-design-equation-derivation">LFOM Design Equation Derivation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FCM_Solution.html">Flow Control and Measurement Solution</a></li>
</ul>
<p class="caption"><span class="caption-text">Chapter 4: Rapid Mix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Rapid_Mix/RM_Intro.html">Rapid Mix Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rapid_Mix/RM_Design.html">Rapid Mix Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rapid_Mix/RM_Derivations.html">Rapid Mix Derivations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rapid_Mix/RM_Examples.html">Rapid Mix Appendix C: Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rapid_Mix/RM_Theory_and_Future_Work.html">Rapid Mix Theory and Future Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rapid_Mix/RM_Mechanical_Solution.html">Rapid Mix Mechanical Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Rapid_Mix/RM_Design_Solution.html">Rapid Mix Design Solution</a></li>
</ul>
<p class="caption"><span class="caption-text">Chapter 5: Flocculation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Flocculation/Floc_Intro.html">Flocculation Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Flocculation/Floc_Model.html">Flocculation Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Flocculation/Floc_Design.html">Flocculation Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Flocculation/Floc_Derivations.html">Flocculation Derivations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Flocculation/Floc_Theory_and_Future_Work.html">Flocculation Theory and Future Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Flocculation/Floc_Examples.html">Flocculation Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Flocculation/Floc_Mechanical_Solution.html">Mechanical Flocculator Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Flocculation/Floc_Model_Solution.html">Flocculation Model Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Flocculation/Floc_Design_Solution.html">Flocculator Design Solution</a></li>
</ul>
<p class="caption"><span class="caption-text">Chapter 6: Sedimentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Sedimentation/Sed_Intro.html">Sedimentation Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Sedimentation/Sed_Design.html">Sedimentation Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Sedimentation/Sed_Examples.html">Sedimentation Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Sedimentation/Sed_Theory_and_Future_Work.html">Sedimentation Theory and Future Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Sedimentation/Sed_Design_Solution.html">Sedimentation Design Solution</a></li>
</ul>
<p class="caption"><span class="caption-text">Chapter 7: Filtration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Filtration/Filtration_Intro.html">Filtration  Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Filtration/Filtration_Design.html">Filtration Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Filtration/Filtration_Derivations.html">Filtration Derivations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Filtration/Filtration_Theory_and_Future_Work.html">Filtration Theory and Future Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Filtration/Filtration_Design_Solution.html">Filtration Design Solution</a></li>
</ul>
<p class="caption"><span class="caption-text">Chapter 8: Dissolved Gas</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Dissolved_Gas/DG_Intro.html">Dissolved Gas Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">Chapter 9: Fluoride</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Fluoride/Fluoride_Intro.html">Fluoride Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">Chapter 10: Wastewater</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../WasteWater/WW_Theory_and_Future_Work.html">WasteWater Theory and Future Work</a></li>
</ul>
<p class="caption"><span class="caption-text">Chapter 11: Troubleshooting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Troubleshooting/Troubleshooting.html">Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Troubleshooting/Troubleshooting.html#solutions">Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Troubleshooting/Troubleshooting.html#proposed-solutions-to-eliminate-iron-oxidizing-slime-bacteria">Proposed solutions to eliminate iron oxidizing slime bacteria</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributor's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Textbook_Creation_Help/rst_intro.html">Introduction to RST and Sphinx for Textbook Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Textbook_Creation_Help/example_aguaclara_rst.html">Functionality in RST and AguaClara Convention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Textbook_Creation_Help/parameter_convention_list.html">Parameter Convention List</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AguaClara Textbook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Flow Control and Measurement Derivations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Flow_Control_and_Measurement/FCM_Derivations.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="flow-control-and-measurement-derivations">
<span id="title-flow-control-derivations"></span><h1>Flow Control and Measurement Derivations<a class="headerlink" href="#flow-control-and-measurement-derivations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="for-a-tank-with-a-valve">
<span id="heading-flow-for-a-tank-with-a-valve"></span><h2><span class="math notranslate nohighlight">\(Q\left(t\right)\)</span> for a Tank with a Valve<a class="headerlink" href="#for-a-tank-with-a-valve" title="Permalink to this headline">¶</a></h2>
<p>This document contains the derivation of the flow through a tank-with-a-valve over time, <span class="math notranslate nohighlight">\(Q\left(t\right)\)</span>. Our reference will be a simple hypochlorinator, shown in the following image. In the image, a hypochlorite solution is slowly dripping and mixing with piped source water, thereby disinfecting it. The valve is almost closed to make sure that the hypochlorite solution drips instead of flows. At the end of this document is an image which shows the variables in the final equation.</p>
<div class="figure align-center" id="id1">
<span id="figure-drip-hypochlorinator"></span><a class="reference internal image-reference" href="../_images/drip_hypochlorinator.png"><img alt="Drip hypochlorinator" src="../_images/drip_hypochlorinator.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 34 </span><span class="caption-text">This is a common setup for chlorinating water before distributing it to a nearby community.</span></p>
</div>
<p>This derivation begins by finding two equations for flow, <span class="math notranslate nohighlight">\(Q\)</span>, through the hypochlorinator and setting them equal to each other. First, the rate of change of the volume of hypochlorite solution in the tank is equivalent to the flow out of the hypochlorinator. Since the volume of hypochlorite solution in the tank is equal to the tank’s cross-sectional area times it height, we get the following equation:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-0">
<span class="eqno">(78)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-0" title="Permalink to this equation">¶</a></span>\[Q =  -\frac{d\rlap{-}V}{dt} = - \frac{{A_{Tank}}dh}{dt}\]</div>
<div class="line-block">
<div class="line">Such that:</div>
<div class="line"><span class="math notranslate nohighlight">\(\frac{d\rlap{-}V}{d t}\)</span> = rate of change in volume of solution in the tank</div>
<div class="line"><span class="math notranslate nohighlight">\(\frac{dh}{d t}\)</span> = rate of change in height of water (hypochlorite solution) level with time</div>
</div>
<p>Our other equation for flow is the head loss equation. Since major losses are negligible for a short pipe-low flow rate system, we only need to consider minor losses. The only real minor loss in this system occurs in the almost-closed valve that is dripping the hypochlorite solution. However, we will also use the head loss trick. Therefore, the total driving head of the system <span class="math notranslate nohighlight">\(h\)</span> is equal to the minor losses:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-1">
<span class="eqno">(79)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-1" title="Permalink to this equation">¶</a></span>\[h = h_e = \left(\sum K \right) \frac{Q^2}{2gA_{Valve}^2}\]</div>
<p>Bear in mind that this is the second form of the minor loss equation as described in <a class="reference internal" href="../Review/Review_Fluid_Mechanics_Derivations.html#heading-final-minor-loss-equations"><span class="std std-ref">this derivation</span></a>. Rearranging the minor loss equation to solve for <span class="math notranslate nohighlight">\(Q\)</span>, it looks like this:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-2">
<span class="eqno">(80)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-2" title="Permalink to this equation">¶</a></span>\[Q = A_{Valve}\sqrt{\frac{2h_eg}{\sum K}}\]</div>
<p>Now we can set both equations for <span class="math notranslate nohighlight">\(Q\)</span> equal to each other and move them both to one side:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-3">
<span class="eqno">(81)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-3" title="Permalink to this equation">¶</a></span>\[A_{Tank}\frac{dh}{dt} + A_{Valve} \sqrt{\frac{2gh}{\sum K}} = 0\]</div>
<p>From here, calculus and equation substitution dominate the derivation. Separating the variables of the equation immediately above, we get the following integral:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-4">
<span class="eqno">(82)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-4" title="Permalink to this equation">¶</a></span>\[\frac{-A_{Tank}}{{A_{Valve}} \sqrt{\frac{2g}{\sum K}} }   \int \limits_{h_0}^h \frac{dh}{\sqrt h} = \int \limits_0^t {dt}\]</div>
<p>Which, when integrated, yields:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-5">
<span class="eqno">(83)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-5" title="Permalink to this equation">¶</a></span>\[\frac{-A_{Tank}}{A_{Valve} \sqrt{ \frac{2g}{\sum K}} } \cdot 2 \left( \sqrt{h} - \sqrt{h_0} \right) = t\]</div>
<p>And solved for <span class="math notranslate nohighlight">\(\sqrt{ h}\)</span> returns:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-6">
<span class="eqno">(84)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-6" title="Permalink to this equation">¶</a></span>\[\sqrt h  = \sqrt{h_0} - t\frac{A_{Valve}}{2 A_{tank}} \sqrt {\frac{2g}{\sum K}}\]</div>
<p>At this point, the steps and equation substitutions may begin to seem unintuitive. Do not worry if you do not understand why <em>exactly</em> a particular substitution is occurring. Since we determined above that :math:` h_e = h`, our equation above for <span class="math notranslate nohighlight">\(\sqrt{ h}\)</span> is also an equation for <span class="math notranslate nohighlight">\(\sqrt{ h_e}\)</span>. As such, we will plug the equation above back into the minor loss equation solved for <span class="math notranslate nohighlight">\(Q\)</span> from above, <span class="math notranslate nohighlight">\(Q = A_ {Valve} \sqrt{\frac{2 h_e g}{\sum K}}\)</span>, to produce:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-7">
<span class="eqno">(85)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-7" title="Permalink to this equation">¶</a></span>\[Q = A_{Valve} \sqrt{\frac{2g}{\sum K}} \left( \sqrt{h_0}  - t \frac{A_{Valve}}{2 A_{tank}} \sqrt{\frac{2g}{\sum K}} \right)\]</div>
<p>Now we can focus on getting rid of the variables <span class="math notranslate nohighlight">\(A_{Valve}\)</span>, <span class="math notranslate nohighlight">\(\sum K\)</span>, and <span class="math notranslate nohighlight">\(A_{tank}\)</span>. By using the minor loss equation once more, we can remove both <span class="math notranslate nohighlight">\(A_{Valve}\)</span> and <span class="math notranslate nohighlight">\(\sum K\)</span>. Consider the initial state of the system, when the hypochlorinator is set up and starts dropping its first few drops of hypochlorite solution into the water. The initial flow rate, <span class="math notranslate nohighlight">\(Q_0\)</span>, and elevation difference between the water level and the valve, <span class="math notranslate nohighlight">\(h_0\)</span>, can be input into the minor loss equation, which can then be solved for <span class="math notranslate nohighlight">\(A_{Valve}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-8">
<span class="eqno">(86)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-8" title="Permalink to this equation">¶</a></span>\[A_{Valve} = \frac{Q_{0}}{ \sqrt{ \frac{2 h_0 g}{\sum K}} }\]</div>
<p>Plugging this equation for <span class="math notranslate nohighlight">\(A_{Valve}\)</span> into the equation for <span class="math notranslate nohighlight">\(Q\)</span> just above, we get the following two equations, in which the second equation is a simplified version of the first:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-9">
<span class="eqno">(87)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-9" title="Permalink to this equation">¶</a></span>\[Q = Q_0 \frac{1}{\sqrt{h_0}} \left( \sqrt{h_0} - \frac{Q_0 t}{2 A_{Tank} \sqrt{h_0}} \right)\]</div>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-10">
<span class="eqno">(88)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-10" title="Permalink to this equation">¶</a></span>\[\frac{Q}{Q_0} = 1 - \frac{t Q_0}{2 A_{Tank} h_0}\]</div>
<p>This next step will eliminate <span class="math notranslate nohighlight">\(A_{Tank}\)</span>. However, it requires some clever manipulation that has a tendency to cause some confusion. We will define a new parameter, <span class="math notranslate nohighlight">\(t_{Design}\)</span>, which represents the time it would take to empty the tank if the initial flow rate through the valve, <span class="math notranslate nohighlight">\(Q_0\)</span>, stays constant in time. Of course, the flow <span class="math notranslate nohighlight">\(Q\)</span> through the valve does not stay constant in time, which is why this derivation document exists. But imagining this hypothetical <span class="math notranslate nohighlight">\(t_{Design}\)</span> parameter allows us to form the following equation:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-11">
<span class="eqno">(89)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-11" title="Permalink to this equation">¶</a></span>\[Q_0 t_{Design} = A_{Tank} h_{Tank}\]</div>
<p>This equation describes draining all the hypochlorite solution from the tank. The volume of the solution, <span class="math notranslate nohighlight">\(A_{Tank} h_{Tank}\)</span>, is drained in <span class="math notranslate nohighlight">\(t_{Design}\)</span>. Rearranged, the equation becomes:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-12">
<span class="eqno">(90)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-12" title="Permalink to this equation">¶</a></span>\[\frac{Q_0}{A_{Tank}} = \frac{h_{Tank}}{t_{Design}}\]</div>
<div class="line-block">
<div class="line">Such that:</div>
<div class="line"><span class="math notranslate nohighlight">\(h_{Tank}\)</span> = elevation of water level in the tank with reference to tank bottom at the initial state, <span class="math notranslate nohighlight">\(t = 0\)</span></div>
</div>
<p>Here lies another common source of confusion. <span class="math notranslate nohighlight">\(h_{Tank}\)</span> is not the same as <span class="math notranslate nohighlight">\(h_{0}\)</span>. <span class="math notranslate nohighlight">\(h_{Tank}\)</span> is the height of water level in the tank with reference to the tank bottom. <span class="math notranslate nohighlight">\(h_{0}\)</span> is the water level in the tank with reference to the valve. Therefore, <span class="math notranslate nohighlight">\(h_{0} \geq h_{Tank}\)</span> is true if the valve is located at or below the bottom of the tank. If the tank is elevated far above the valve, then the <span class="math notranslate nohighlight">\(h_{0} &gt; &gt; h_{Tank}\)</span>. If the valve is at the same elevation as the bottom of the tank, then <span class="math notranslate nohighlight">\(h_{0} = h_{Tank}\)</span>. Please refer to the following image to clarify <span class="math notranslate nohighlight">\(h_{0}\)</span> and <span class="math notranslate nohighlight">\(h_{Tank}\)</span>. Also note that both <span class="math notranslate nohighlight">\(h_{Tank}\)</span> and <span class="math notranslate nohighlight">\(h_{0}\)</span> are not variables, they are constants which are defined by the initial state of the hypochlorinator, when the solution just begins to flow.</p>
<div class="figure align-center" id="id2">
<span id="figure-hypochlorinator-variable-explanation"></span><a class="reference internal image-reference" href="../_images/hypochlorinator_variable_explanation.png"><img alt="Hypochlorinator variables" src="../_images/hypochlorinator_variable_explanation.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 35 </span><span class="caption-text"><span class="math notranslate nohighlight">\(Q_0 =\)</span> initial flow rate of hypochlorite solution at time <span class="math notranslate nohighlight">\(t = 0\)</span>, <span class="math notranslate nohighlight">\(t_{Design} =\)</span> time it would take to drain the tank if flow was held constant at <span class="math notranslate nohighlight">\(Q_0\)</span></span></p>
</div>
<p>Finally, our fabricated equivalence, <span class="math notranslate nohighlight">\(\frac{Q_0}{A_{Tank}} = \frac{h_{Tank}}{t_{Design}}\)</span> can be plugged into <span class="math notranslate nohighlight">\(\frac{Q}{Q_0} = 1 - \frac{t Q_0}{2 A_{Tank} h_0}\)</span> to create the highly useful equation for flow rate as a function of time for a drip hypochlorinator:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-13">
<span class="eqno">(91)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-13" title="Permalink to this equation">¶</a></span>\[\color{purple}{
\frac{Q}{Q_0} = 1 - \frac{1}{2} \frac{t}{t_{Design}} \frac{h_{Tank}}{h_0}
}\]</div>
<p>Which can be slightly rearranged to yield:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-14">
<span class="eqno">(92)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-14" title="Permalink to this equation">¶</a></span>\[\color{purple}{
Q(t) = Q_0 \left( 1 - \frac{1}{2} \frac{t}{t_{Design}} \frac{h_{Tank}}{h_0} \right)
}\]</div>
<div class="line-block">
<div class="line">Such that:</div>
<div class="line"><span class="math notranslate nohighlight">\(Q = Q(t)\)</span> = flow of hypochlorite through valve at time <span class="math notranslate nohighlight">\(t\)</span></div>
<div class="line"><span class="math notranslate nohighlight">\(t\)</span> = elapsed time</div>
<div class="line"><span class="math notranslate nohighlight">\(t_{Design}\)</span> = time it would take for tank to empty <em>if</em> flow stayed constant at <span class="math notranslate nohighlight">\(Q_0\)</span>, which it does not</div>
<div class="line"><span class="math notranslate nohighlight">\(h_{Tank}\)</span> = elevation of water level with reference to tank bottom</div>
<div class="line"><span class="math notranslate nohighlight">\(h_0\)</span> = elevation of water level with reference to the valve</div>
</div>
<p>“How does this ‘tank with a valve’ scenario differ from the ‘hole in a bucket’ scenario?” some might ask. If you are interested, you may go through the derivation on your own using the orifice equation instead of the minor loss equation for the first step. If you do so you’ll find that the equation remains almost the same, the only difference being that the <span class="math notranslate nohighlight">\(\frac{h_{Tank}}{h_0}\)</span> term drops out for an orifice, as <span class="math notranslate nohighlight">\(h_{Tank} = h_0\)</span>. The big difference in the systems lies with the flexibility of having a valve. It can be tightened or loosened to change the flow rate, whereas changing the size of an orifice multiple times in a row is not recommended and is usually irreversible.</p>
</div>
<div class="section" id="and-for-tank-drain-equation">
<span id="heading-diameter-and-time-tank-drain-equation"></span><h2><span class="math notranslate nohighlight">\(D(t)\)</span> and <span class="math notranslate nohighlight">\(t(D)\)</span> for Tank Drain Equation<a class="headerlink" href="#and-for-tank-drain-equation" title="Permalink to this headline">¶</a></h2>
<p>This document contains the derivation of <span class="math notranslate nohighlight">\(D_{Pipe}\)</span>, which is the pipe diameter necessary to install in a drain system to entirely drain a tank in time <span class="math notranslate nohighlight">\(t_{Drain}\)</span>.</p>
<p>First, it is necessary to understand how AguaClara tank drains work and what they look like. Many tanks, including the flocculator and entrance tank, have a hole in their bottoms which are fitted with <a class="reference external" href="https://www.mrpoolman.com.au/assets/thumbL/16057.jpg">pipe couplings</a>. During normal operation, these couplings have pipe stubs in them, and the pipe stubs are tall enough to go above the water level in the tank and not allow water to flow into the drain. When the pipe stub is removed, the water begins to flow out of the drain, as the image below indicates. The drain pipe consists of pipe and one elbow, shown in the image.</p>
<div class="figure align-center" id="id3">
<span id="figure-pipe-stub-drainage"></span><a class="reference internal image-reference" href="../_images/pipe_stub_drainage.png"><img alt="Pipe stub drainage" src="../_images/pipe_stub_drainage.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 36 </span><span class="caption-text">This is AguaClara’s alternatives to having valves.</span></p>
</div>
<p>While AguaClara sedimentation tanks use valves instead of pipe to begin the process of draining, the actual drain piping system is the same, pipe and an elbow. The equation that will soon be derived applies to both pipe stub and valve drains.</p>
<p>We will start the derivation from the following equation, which is found in an intermediate step from the ‘<span class="math notranslate nohighlight">\(Q(t)\)</span> <a class="reference internal" href="#heading-flow-for-a-tank-with-a-valve"><span class="std std-ref"> for a Tank with a Valve</span></a>.’ While this system does not have a valve, it has other sources of minor loss and therefore the equation is still valid.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-15">
<span class="eqno">(93)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-15" title="Permalink to this equation">¶</a></span>\[\sqrt h  = \sqrt{h_0} - t \frac{A_{Valve}}{2 A_{Tank}} \sqrt {\frac{2g}{K}}\]</div>
<p>We need to make some adjustments to this equation before proceeding, to make it applicable for this new drain-system scenario. First, we want to assume that the tank has fully drained. Thus, <span class="math notranslate nohighlight">\(t = t_{Drain}\)</span> and <span class="math notranslate nohighlight">\(h = 0\)</span>. Next, we recall that the tank drain is not actually a valve, but just pipe and an elbow, so <span class="math notranslate nohighlight">\(A_{Valve} = A_{Pipe}\)</span>. Additionally, there can be multiple points of minor loss in the drain system: the entrance from the tank into the drain pipe, the elbow, and potentially the exit of the water out of the drain pipe. When considering a sedimentation tank, the open valve required to begin drainage also has a minor loss associated with it. Therefore, it is necessary to substitute <span class="math notranslate nohighlight">\(\sum K\)</span> for <span class="math notranslate nohighlight">\(K\)</span> With these substitutions, the equation becomes:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-16">
<span class="eqno">(94)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-16" title="Permalink to this equation">¶</a></span>\[\sqrt{h_0}  = t_{Drain} \frac{A_{Pipe}}{2 A_{Tank}} \sqrt {\frac{2g}{\sum K}}\]</div>
<p>Now, with the knowledge that <span class="math notranslate nohighlight">\(A_{Pipe} = \frac{\pi D_{Pipe}^2}{4}\)</span> and rearranging to solve for <span class="math notranslate nohighlight">\(D_{Pipe}\)</span>, we obtain the following equation:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-17">
<span class="eqno">(95)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-17" title="Permalink to this equation">¶</a></span>\[D_{Pipe} = \sqrt{ \frac{8 A_{Tank}}{\pi t_{Drain}} \sqrt{ \frac{h_0 \sum K}{2g} } }\]</div>
<p>To get the equation in terms of easily measureable tank parameters, we substitute <span class="math notranslate nohighlight">\(L_{Tank} W_{Tank}\)</span> for <span class="math notranslate nohighlight">\(A_{Tank}\)</span>. To maintain consistency in variable names, we substitute <span class="math notranslate nohighlight">\(H_{Tank}\)</span> for <span class="math notranslate nohighlight">\(h_0\)</span>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By saying that <span class="math notranslate nohighlight">\(h_0 = H_{Tank}\)</span>, we are making the assumption that the pipe drain is at the same elevation as the bottom of the tank. The pipe drain is actually a little lower than the bottom of the tank, but that would make the tank drain faster than <span class="math notranslate nohighlight">\(t_{Drain}\)</span>, which is preferred. Therefore, we are designing a slight safety factor when we say that <span class="math notranslate nohighlight">\(h_0 = H_{Tank}\)</span>.</p>
</div>
<p>Finally, we arrive at the equation for drain pipe sizing:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-18">
<span class="eqno">(96)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-18" title="Permalink to this equation">¶</a></span>\[\color{purple}{
D_{Pipe} = \sqrt{ \frac{8 L_{Tank} W_{Tank}}{\pi t_{Drain}}} \left( \frac{H_{Tank} \sum K}{2g} \right)^{\frac{1}{4}}
}\]</div>
<p>We can also easily rearrange to find the time required to drain a tank given a drain diameter:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-19">
<span class="eqno">(97)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-19" title="Permalink to this equation">¶</a></span>\[\color{purple}{
t_{Drain} = \frac{8 L_{Tank} W_{Tank}}{\pi D_{Pipe}^2} \sqrt{ \frac{H_{Tank} \sum K}{2g} }
}\]</div>
<p>Such that the variables are as the appear in the image below.</p>
<div class="figure align-center" id="id4">
<span id="figure-pipe-stub-drainage-variables"></span><a class="reference internal image-reference" href="../_images/pipe_stub_drainage_variables.png"><img alt="Pipe stub drainage variables" src="../_images/pipe_stub_drainage_variables.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 37 </span><span class="caption-text"><span class="math notranslate nohighlight">\(L_{Tank}\)</span> is the length of the tank which goes the page. <span class="math notranslate nohighlight">\(K\)</span> is the aggregate minor loss coefficient of the drain system.</span></p>
</div>
</div>
<div class="section" id="design-equations-for-the-linear-chemical-dose-controller-cdc">
<span id="heading-design-equations-for-the-cdc"></span><h2>Design Equations for the Linear Chemical Dose Controller (CDC)<a class="headerlink" href="#design-equations-for-the-linear-chemical-dose-controller-cdc" title="Permalink to this headline">¶</a></h2>
<p>This document will include the equation derivations required to design a CDC system. The most important restriction in this design process is maintaining linearity between head <span class="math notranslate nohighlight">\(h\)</span> and flow <span class="math notranslate nohighlight">\(Q\)</span>, which is the entire purpose of the CDC. Recall that major losses under laminar flow scale with <span class="math notranslate nohighlight">\(Q\)</span> and minor losses scale with <span class="math notranslate nohighlight">\(Q^2\)</span> Since it is impossible to remove minor losses from the system entirely, we will simply try to make minor losses very small compared to major losses. The CDC does this by including ‘dosing tube(s),’ which are long, straight tubes designed to generate a lot of major losses. There can be one tube or multiple, depending on the design conditions.</p>
<p>We will use the ‘head loss trick’ that was introduced in the Fluids Review section. Therefore, the elevation difference between the water level in the constant head tank (CHT) and the end of the tube connected to the slider, <span class="math notranslate nohighlight">\(\Delta h\)</span>, is equal to the head loss between the two points, <span class="math notranslate nohighlight">\(h_L\)</span>. Thus, <span class="math notranslate nohighlight">\(\Delta h = h_L = h_e + h_f\)</span>.</p>
<div class="figure align-center" id="id5">
<span id="figure-cdc-derivation"></span><a class="reference internal image-reference" href="../_images/CDC_derivation.png"><img alt="CDC Derivation" src="../_images/CDC_derivation.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 38 </span><span class="caption-text">Visual representation of CDC.</span></p>
</div>
<div class="section" id="cdc-design-equation-derivation">
<span id="heading-cdc-design-equation-derivations"></span><h3>CDC Design Equation Derivation<a class="headerlink" href="#cdc-design-equation-derivation" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><strong>When designing the CDC, there are a few parameters which are picked and set initially, before applying any equations. These parameters are:</strong></p>
</div>
<ol class="arabic simple">
<li><span class="math notranslate nohighlight">\(D\)</span> = tube diameter. only certain tubing diameters are manufactured (like <span class="math notranslate nohighlight">\(\frac{x}{16}\)</span> inch), so an array of available tube diameters is set initially.</li>
<li><span class="math notranslate nohighlight">\(\sum K\)</span> = sum of minor loss coefficients for the whole system. This is also set initially, it is usually 2.</li>
<li><span class="math notranslate nohighlight">\(h_{L_{Max}}\)</span> = maximum elevation difference between CHT water level and outlet of solution. This parameter is usually 20 cm.</li>
</ol>
<p>We begin by defining the head loss through the system <span class="math notranslate nohighlight">\(h_L\)</span>, which is equivalent to defining the driving head <span class="math notranslate nohighlight">\(\Delta h\)</span>. Major losses will be coded as red.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-20">
<span class="eqno">(98)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-20" title="Permalink to this equation">¶</a></span>\[\color{red}{
  h_{\rm{f}} = \frac{128\nu LQ}{g\pi D^4}
  }\]</div>
<div class="line-block">
<div class="line">Such that:</div>
<div class="line"><span class="math notranslate nohighlight">\(\nu\)</span> = kinematic viscosity <em>of the solution going through the dosing tube(s)</em>. This is either coagulant or chlorine</div>
<div class="line"><span class="math notranslate nohighlight">\(Q\)</span> = flow rate through the dosing tube(s)</div>
<div class="line"><span class="math notranslate nohighlight">\(L\)</span> = length of the dosing tube(s)</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">‘Tube(s)’ is used because there may be 1 or more dosing tubes depending on the particular design.</p>
</div>
<p>Minor losses are equal to:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-21">
<span class="eqno">(99)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-21" title="Permalink to this equation">¶</a></span>\[h_e = \frac{8 Q^2}{g \pi^2 D^4} \sum{K}\]</div>
<p>Therefore, the total head loss is a function of flow, and is shown in the following equation.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-22">
<span class="eqno">(100)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-22" title="Permalink to this equation">¶</a></span>\[h_L(Q) =
{\color{red}{
  \frac{128\nu L Q}{g \pi D^4}}} +
  \frac{8Q^2}{g \pi^2 D^4} \sum K\]</div>
<p>Blue will be used to reference <em>actual</em> head loss from now on. This is the same equation as above.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-23">
<span class="eqno">(101)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-23" title="Permalink to this equation">¶</a></span>\[\color{blue}{
  h_L(Q) = \left( \frac{128\nu L}{g \pi D^4} + \frac{8Q}{g \pi ^2 D^4} \sum{K} \right) Q
  }\]</div>
<p>This equation is not linear with respect to flow. We can make it linear by turning the variable <span class="math notranslate nohighlight">\(Q\)</span> in the <span class="math notranslate nohighlight">\(\frac{8Q}{g \pi ^2 D^4} \sum{K}\)</span> term into a constant. To do this, we pick a maximum flow rate of coagulant/chlorine through the dose controller, <span class="math notranslate nohighlight">\(Q_{Max}\)</span>, and put that into the term in place of <span class="math notranslate nohighlight">\(Q\)</span>. The term becomes <span class="math notranslate nohighlight">\(\frac{8Q_{Max}}{g \pi ^2 D^4} \sum{K}\)</span>, and our linearized model of head loss, coded as green, becomes:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-24">
<span class="eqno">(102)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-24" title="Permalink to this equation">¶</a></span>\[\color{green}{
  h_{L_{linear}}(Q) = \left( \frac{128\nu L}{g \pi D^4} + \frac{8Q_{Max}}{g \pi ^2 D^4} \sum{K} \right) Q
  }\]</div>
<p>Here is a plot of the three colored equations above. Our goal is to minimize the minor losses in the system; to bring the red and blue curves as close as possible to the green one.</p>
<div class="figure align-center" id="id6">
<span id="figure-cdc-linearity-model"></span><a class="reference internal image-reference" href="../_images/CDC_linearity_model.png"><img alt="CDC linearity model" src="../_images/CDC_linearity_model.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 39 </span><span class="caption-text">MathCAD generated graph for linearity error analysis. TODO: make this in python</span></p>
</div>
<div class="section" id="designing-for-the-error-constraint">
<h4>Designing for the error constraint, <span class="math notranslate nohighlight">\(\Pi_{Error}\)</span><a class="headerlink" href="#designing-for-the-error-constraint" title="Permalink to this headline">¶</a></h4>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The first step in the design is to make sure that major losses far exceed minor losses. This will result in an equation for the maximum velocity that can go through the dosing tube(s), <span class="math notranslate nohighlight">\(\color{purple}{\bar v_{Max} }\)</span>.</p>
</div>
<p>Minor losses will never be 0, so how much error in our linearity are we willing to accept? Let’s define a new parameter, <span class="math notranslate nohighlight">\(\Pi_{Error}\)</span>, as the maximum amount of error we are willing to accept. We are ok with 10% error or less, so <span class="math notranslate nohighlight">\(\Pi_{Error} = 0.1\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-25">
<span class="eqno">(103)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-25" title="Permalink to this equation">¶</a></span>\[\Pi_{Error} = \frac{\color{green}{ h_{L_{linear}} } - \color{blue}{ h_L }}{\color{green}{ h_{L_{linear}} }} = 1 - \frac{\color{blue}{ h_L }}{\color{green}{ h_{L_{linear}} }}\]</div>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-26">
<span class="eqno">(104)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-26" title="Permalink to this equation">¶</a></span>\[1 - \Pi_{Error} = \frac{\color{blue}{ h_L }}{\color{green}{ h_{L_{linear}} }}\]</div>
<p>Now we plug <span class="math notranslate nohighlight">\(\color{blue}{ h_L(Q) }\)</span> and <span class="math notranslate nohighlight">\(\color{green}{ h_{L_{linear}} }\)</span> back into the equation for <span class="math notranslate nohighlight">\(1 - \Pi_{Error}\)</span> and take the limit as <span class="math notranslate nohighlight">\(Q \rightarrow 0\)</span>, as that is when the relative difference between actual head loss and our linear model for head loss is the greatest.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-27">
<span class="eqno">(105)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-27" title="Permalink to this equation">¶</a></span>\[1 - \Pi_{Error} =
  \frac{ \color{blue}{
  \left( \frac{128 \nu L}{g \pi D^4} +
  \cancel{\frac{8Q}{g \pi^2 D^4} \sum{K}}
  \right) Q
  }}
  {\color{green}{
  \left( \frac{128 \nu L}{g \pi D^4} + \frac{8 Q_{Max}}{g \pi^2 D^4} \sum{K} \right) Q
  }}
  =     \frac{\left( \frac{128 \nu L}{g \pi D^4} \right)}{\left( \frac{128 \nu L}{g \pi D^4} + \frac{8 Q_{Max}}{g \pi^2 D^4} \sum{K} \right)}\]</div>
<p>The next steps are algebraic rearrangements to solve for <span class="math notranslate nohighlight">\(L\)</span>. This <span class="math notranslate nohighlight">\(L\)</span> describes the <em>minimum</em> length of dosing tube necessary to meet our error constraint at <em>maximum</em> flow. Thus, we will refer to it as <span class="math notranslate nohighlight">\(L_{Min, \, \Pi_{Error}}\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-28">
<span class="eqno">(106)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-28" title="Permalink to this equation">¶</a></span>\[\left( 1 - \Pi_{Error} \right)  \frac{128 \nu L}{g \pi D^4} + \left( 1 - \Pi_{Error} \right) \frac{8 Q_{Max}}{g \pi ^2 D^4} \sum{K}  =  \frac{128 \nu L}{g \pi D^4}\]</div>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-29">
<span class="eqno">(107)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-29" title="Permalink to this equation">¶</a></span>\[- \Pi_{Error} \frac{128 \nu L}{g \pi D^4} + \left( 1 - \Pi_{Error} \right) \frac{8 Q_{Max}}{g \pi^2 D^4} \sum{K}  = 0\]</div>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-30">
<span class="eqno">(108)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-30" title="Permalink to this equation">¶</a></span>\[L = \left( \frac{1 - \Pi_{Error}}{\Pi_{Error}} \right) \frac{Q_{Max}}{16 \nu \pi} \sum{K}\]</div>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-31">
<span class="eqno">(109)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-31" title="Permalink to this equation">¶</a></span>\[L_{Min, \, \Pi_{Error}} = L = \left( \frac{1 - \Pi_{Error}}{\Pi_{Error}} \right) \frac{Q_{Max}}{16 \nu \pi} \sum{K}\]</div>
<div class="line-block">
<div class="line">Note that this equation is independent of head loss.</div>
</div>
<p>Unfortunately, both <span class="math notranslate nohighlight">\(L_{Min, \, \Pi_{Error}}\)</span> and <span class="math notranslate nohighlight">\(Q_{Max}\)</span> are unknowns. We can plug this equation for <span class="math notranslate nohighlight">\(L_{Min, \, \Pi_{Error}}\)</span> back into the head loss equation at maximum flow, which is <span class="math notranslate nohighlight">\(h_{L_{Max}} = \left( \frac{128\nu L Q_{Max}}{g \pi D^4} + \frac{8Q_{Max}^2}{g \pi ^2 D^4} \sum{K} \right)\)</span> and rearrange for <span class="math notranslate nohighlight">\(Q_{Max}\)</span> to get:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-32">
<span class="eqno">(110)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-32" title="Permalink to this equation">¶</a></span>\[Q_{Max} = \frac{\pi D^2}{4} \sqrt{\frac{2 h_{L_{Max}} g \Pi_{Error}}{\sum K }}\]</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><strong>Function in aguaclara</strong> <code class="docutils literal notranslate"><span class="pre">cdc.max_linear_flow(Diam,</span> <span class="pre">HeadlossCDC,</span> <span class="pre">Ratio_Error,</span> <span class="pre">KMinor)</span></code> Returns the maximum flow <span class="math notranslate nohighlight">\(Q_{Max}\)</span> that can go through a dosing tube will making sure that linearity between head loss and flow is conserved.</p>
</div>
<p>From this equation for <span class="math notranslate nohighlight">\(Q_{Max}\)</span>, we can get to our first design equation, <span class="math notranslate nohighlight">\(\color{purple}{\bar v_{Max}}\)</span> by using the continuity equation <span class="math notranslate nohighlight">\(\bar v_{Max} = \frac{Q_{Max}}{\frac{\pi D^2}{4}}\)</span></p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-33">
<span class="eqno">(111)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-33" title="Permalink to this equation">¶</a></span>\[\color{purple}{
  \bar v_{Max} = \sqrt{ \frac{2 h_L g \Pi_{Error}}{\sum{K} }}
  }\]</div>
</div>
<div class="section" id="designing-for-the-proper-amount-of-head-loss">
<h4>Designing for the proper amount of head loss, <span class="math notranslate nohighlight">\(h_{L_{Max}}\)</span><a class="headerlink" href="#designing-for-the-proper-amount-of-head-loss" title="Permalink to this headline">¶</a></h4>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The second step in the design is to make sure that the maximum head loss corresponds to the maximum flow of chemicals. This will result in an equation for the length of the dosing tube(s), <span class="math notranslate nohighlight">\(\color{purple}{L_{Min} }\)</span>.</p>
</div>
<p>We previously derived an equation for the minimum length of the dosing tube(s), <span class="math notranslate nohighlight">\(L_{Min, \, \Pi_{Error}}\)</span>, which was the minimum length needed to ensure that our linearity constraint was met. This equation is shown again below, in red:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-34">
<span class="eqno">(112)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-34" title="Permalink to this equation">¶</a></span>\[\color{red}{
  L_{Min, \, \Pi_{Error}} = \left( \frac{1 - \Pi_{Error}}{\Pi_{Error}} \right) \frac{Q_{Max}}{16 \nu \pi} \sum{K}
  }\]</div>
<p>This equation does not, however, account for getting to the proper amount of head loss. If we were to use this equation to design the dosing tubes, we might not end up with the proper amount of flow <span class="math notranslate nohighlight">\(Q_{Max}\)</span> at the maximum head loss <span class="math notranslate nohighlight">\(h_{L{Max}}\)</span>. So we need to double check to make sure that we get our desired head loss.</p>
<p>First, consider the head loss at maximum flow that was used to get the equation for <span class="math notranslate nohighlight">\(Q_{Max}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-35">
<span class="eqno">(113)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-35" title="Permalink to this equation">¶</a></span>\[h_{L_{Max}} = \left( \frac{128 \nu L{Q_{Max}}}{g \pi D^4} + \frac{8 Q_{Max}^2}{g \pi^2 D^4} \sum{K} \right)\]</div>
<p>Now that we know all of the parameters in this equation except for <span class="math notranslate nohighlight">\(L\)</span>, we can solve the equation for <span class="math notranslate nohighlight">\(L\)</span>. This the <em>shortest</em> tube that generates our required head loss, <span class="math notranslate nohighlight">\(h_{L_{Max}}\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-36">
<span class="eqno">(114)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-36" title="Permalink to this equation">¶</a></span>\[\color{green}{
   L_{Min, \, head loss} = L = \left( \frac{g h_{L_{Max}} \pi D^4}{128 \nu Q_{Max}} - \frac{Q_{Max}}{16 \pi \nu} \sum{K} \right)
   }\]</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><strong>Function in aguaclara:</strong> <code class="docutils literal notranslate"><span class="pre">cdc._length_cdc_tube_array(FlowPlant,</span> <span class="pre">ConcDoseMax,</span> <span class="pre">ConcStock,</span> <span class="pre">DiamTubeAvail,</span> <span class="pre">HeadlossCDC,</span> <span class="pre">temp,</span> <span class="pre">en_chem,</span> <span class="pre">KMinor)</span></code> Returns <span class="math notranslate nohighlight">\(\color{purple}{L_{Min}}\)</span>, takes in the flow rate input of <em>plant design flow rate</em>.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><strong>Function in aguaclara:</strong> <code class="docutils literal notranslate"><span class="pre">cdc._len_tube(Flow,</span> <span class="pre">Diam,</span> <span class="pre">HeadLoss,</span> <span class="pre">conc_chem,</span> <span class="pre">temp,</span> <span class="pre">en_chem,</span> <span class="pre">KMinor)</span></code> Returns <span class="math notranslate nohighlight">\(\color{purple}{L_{Min}}\)</span>, takes in the flow rate input of <em>max flow rate through the dosing tube(s)</em>.</p>
</div>
<p>If you decrease the max flow <span class="math notranslate nohighlight">\(Q_{Max}\)</span> and hold <span class="math notranslate nohighlight">\(h_{L_{Max}}\)</span> constant, <span class="math notranslate nohighlight">\(\color{green}{L_{Min, \, head loss}}\)</span> becomes larger. This means that a CDC system for a plant of 40 <span class="math notranslate nohighlight">\(\frac{L}{s}\)</span> must be different than one for a plant of 20 <span class="math notranslate nohighlight">\(\frac{L}{s}\)</span>. If we want to maintain the same head loss at maximum flow in both plants, then the dosing tube(s) will need to be a lot longer for the 20 <span class="math notranslate nohighlight">\(\frac{L}{s}\)</span> plant.</p>
<p>To visualize the distinction between <span class="math notranslate nohighlight">\(\color{red}{  L_{Min, \, \Pi_{Error}}}\)</span> and <span class="math notranslate nohighlight">\(\color{green}{ L_{Min, \, head loss}}\)</span>, see the following plot. <span class="math notranslate nohighlight">\(\color{green}{ L_{Min, \, head loss}}\)</span> is discontinuous because it takes in the smallest allowable tube diameter as an input. As the chemical flow rate through the dosing tube(s) decreases, the dosing tube diameter does as well. Whenever you see a jump in the green points, that means the tubing diameter has changed.</p>
<div class="figure align-center" id="id7">
<span id="figure-cdc-length-model"></span><a class="reference internal image-reference" href="../_images/CDC_length_model.png"><img alt="CDC length model" src="../_images/CDC_length_model.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 40 </span><span class="caption-text">CDC length modeling in MathCAD.</span></p>
</div>
<p>As you can see, the head loss constraint is more limiting than the linearity constraint when designing for tube length. Therefore, the design equation for tube length is the one which accounts for head loss. This is the second and final design equation for designing the CDC:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-37">
<span class="eqno">(115)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-37" title="Permalink to this equation">¶</a></span>\[\color{purple}{
L_{Min} = L_{Min, \, head loss} = \left( \frac{g h_{L_{Max}} \pi D^4}{128 \nu Q_{Max}} - \frac{Q_{Max}}{16 \pi \nu} \sum{K} \right)
}\]</div>
<p>The equations for <span class="math notranslate nohighlight">\(\color{purple}{\bar v_{Max}}\)</span> and <span class="math notranslate nohighlight">\(\color{purple}{L_{Min}}\)</span> are the only ones you <strong>need</strong> to manually design a CDC.</p>
</div>
<div class="section" id="cdc-dosing-tube-s-diameter-plots">
<h4>CDC Dosing Tube(s) Diameter <span class="math notranslate nohighlight">\(D_{Min}\)</span> Plots<a class="headerlink" href="#cdc-dosing-tube-s-diameter-plots" title="Permalink to this headline">¶</a></h4>
<p>Below are equations which also govern the CDC and greatly aid in understanding the physics behind it, but are not strictly necessary in design.</p>
<p>By rearranging <span class="math notranslate nohighlight">\(Q_{Max} = \frac{\pi D^2}{4} \sqrt{\frac{2 h_L g \Pi_{Error}}{\sum K }}\)</span>, we can solve for <span class="math notranslate nohighlight">\(D\)</span> to get the <em>minimum</em> diameter we can use assuming the shortest tube possible that meets the error constraint, <span class="math notranslate nohighlight">\(\color{red}{L_{Min, \, \Pi_{Error}}}\)</span>. If we use a diameter smaller than <span class="math notranslate nohighlight">\(D_{Min, \, \Pi_{Error}}\)</span>, we will not be able to simultaneously reach <span class="math notranslate nohighlight">\(Q_{Max}\)</span> and meet the error constraint <span class="math notranslate nohighlight">\(\Pi_{Error}\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-38">
<span class="eqno">(116)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-38" title="Permalink to this equation">¶</a></span>\[\color{blue}{
D_{Min, \, \Pi_{Error}} = \left[ \frac{8 Q_{Max}^2 \sum K}{\Pi_{Error} h_l g \pi^2} \right]^{\frac{1}{4}}
}\]</div>
<p>We can also find the minimum diameter needed to guarantee laminar flow, which is another critical condition in the CDC design. We can do this by combining the equation for Reynolds number at the maximum <span class="math notranslate nohighlight">\(\rm{Re}\)</span> for laminar flow, <span class="math notranslate nohighlight">\({\rm{Re}}_{Max} = 2100\)</span> with the continuity equation at maximum flow:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-39">
<span class="eqno">(117)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-39" title="Permalink to this equation">¶</a></span>\[{\rm Re}_{Max}  = \frac{\bar v_{Max} D}{\nu}\]</div>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-40">
<span class="eqno">(118)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-40" title="Permalink to this equation">¶</a></span>\[\bar v_{Max} = \frac{4 Q_{Max}}{\pi D^2}\]</div>
<p>To get:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-41">
<span class="eqno">(119)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-41" title="Permalink to this equation">¶</a></span>\[\color{red}{
D_{Min, \, Laminar} = \frac{4 Q_{Max}}{\pi \nu {\rm{Re}}_{Max}}
}\]</div>
<p>Combined with the discrete amount of tubing sizes (shown in dark green), we can create a graph of the three diameter constraints:</p>
<div class="figure align-center" id="id8">
<span id="figure-cdc-diameter-model"></span><a class="reference internal image-reference" href="../_images/CDC_diameter_model.png"><img alt="CDC diameter model" src="../_images/CDC_diameter_model.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 41 </span><span class="caption-text">CDC diameter modeling in MathCAD.</span></p>
</div>
</div>
</div>
<div class="section" id="lfom-design-equation-derivation">
<span id="heading-lfom-design-equation-derivations"></span><h3>LFOM Design Equation Derivation<a class="headerlink" href="#lfom-design-equation-derivation" title="Permalink to this headline">¶</a></h3>
<p>The LFOM design is based off that of a stout weir. A stout weir is an infinitely tall weir where the width, <span class="math notranslate nohighlight">\(w\)</span>, at any given height, :math:` h` can be given by this equation:
:math:` w=frac{alpha}{sqrt{h}}`. Where alpha is a scaling parameter.</p>
<p>The flow through this weir can be solved using the orifice equation.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-42">
<span class="eqno">(120)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-42" title="Permalink to this equation">¶</a></span>\[Q = \Pi_{VC} A_{or} \sqrt{ 2g\Deltah}\]</div>
<p>The parameters of the stout weir can be substituted into this equation to yield:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-43">
<span class="eqno">(121)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-43" title="Permalink to this equation">¶</a></span>\[Q(h)  = \Pi_{VC} \int_{0}^{h} \sqrt{ 2g(h-x)}  \frac{\alpha}{\sqrt{ x}} dx\]</div>
<p>When the flow rate, <span class="math notranslate nohighlight">\(Q\)</span>, is at the plant flow rate, <span class="math notranslate nohighlight">\(Q_{ plant}\)</span>, the height, :math:` h`, is equal to the max height of the LFOM, :math:` h_{d,max}`.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-44">
<span class="eqno">(122)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-44" title="Permalink to this equation">¶</a></span>\[\frac{ Q_{plant}}{\alpha}  = \Pi_{VC}\sqrt{2g}\int_{0}^{h_{d,max}} \sqrt{(h_{d,max}-x)}  \frac{1}{\sqrt{ x}} dx\]</div>
<p>Solving this we can determine a value for alpha</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-45">
<span class="eqno">(123)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-45" title="Permalink to this equation">¶</a></span>\[\alpha  = \frac{ Q_{plant}}{\Pi_{VC}\sqrt{2g}\int_{0}^{h_{d,max}} \sqrt{(h_{d,max}-x)}  \frac{1}{\sqrt{ x}} dx} = \frac{2 Q_{plant}}{\Pi_{VC} \pi h_{d,max} \sqrt{2g}}\]</div>
<p>From now on this equation will represent the height in the stout weir:</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-46">
<span class="eqno">(124)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-46" title="Permalink to this equation">¶</a></span>\[y\left( x \right) = \frac{\alpha}{\sqrt{x}} = \frac{ 2 Q_{plant}}{\Pi_{VC} \pi h_{d,max} \sqrt{2 g x}}\]</div>
<p>The average velocity exiting the LFOM can be calculated  by using the weight of the falling water from the height, <span class="math notranslate nohighlight">\(x\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-47">
<span class="eqno">(125)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-47" title="Permalink to this equation">¶</a></span>\[V_{exit} = \frac{ 2g\Pi_{VC}}{Q_{plant}}\int_{0}^{h_{d,max}} \sqrt{x(h_{d,max} -x)} y(x) dx\]</div>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-48">
<span class="eqno">(126)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-48" title="Permalink to this equation">¶</a></span>\[V_{exit} = \frac{\sqrt{8g}}{\pi h_{d,max}} \int_{0}^{h_{d,max}} \sqrt{(h_{d,max} -x)}  dx = \frac{4 \sqrt{2gh_{d,max}}}{3\pi}\]</div>
<p>From the conservation of mass equation, <span class="math notranslate nohighlight">\(Q = V A\)</span>, the area of the LFOM can be derived, a factor of safety, :math:` f_s`, will be added.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-49">
<span class="eqno">(127)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-49" title="Permalink to this equation">¶</a></span>\[A_{LFOM} = f_s \frac{ Q_{plant}}{ V_{exit}} =  f_s \frac{ 3 \pi Q_{plant}}{4 \sqrt{2gh_{d,max}}}\]</div>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-50">
<span class="eqno">(128)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-50" title="Permalink to this equation">¶</a></span>\[D_{LFOM,min} = 2 \sqrt{\frac{ A_{LFOM}}{ \pi}} =  \sqrt{\frac{3 Q_{plant}}{ \sqrt{2gh_{d,max}}}}\]</div>
<p>This inner diameter will then be rounded upper to the nearest available PVC pipe inner diameter.</p>
<p>Now that we have the size of the LFOM pipe, we need to discretize the opening into rows of small orifices.</p>
<p>The number of rows in the LFOM, <span class="math notranslate nohighlight">\(N_{ rows}\)</span> is currently an expert input in the AguaClara design code with a value of 10. The spacing between the center of each row is then <span class="math notranslate nohighlight">\(S_{LFOM,rows} =\frac{h_{d,max}}{N_{ rows}}\)</span></p>
<p>The maximum diameter of each orifice is therefore the spacing between the rows.</p>
<p><span class="math notranslate nohighlight">\(D_{LFOM,or,max} = S_{LFOM, rows}\)</span></p>
<p>The area of each row of orifices can calculated using by integrating the width function over x</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-51">
<span class="eqno">(129)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-51" title="Permalink to this equation">¶</a></span>\[A_{LFOM,toprow} = \int_{h_{d,max} - c}^{h_{d,max}} y(x) dx\]</div>
<p>In the AguaClara plant design code, this area is approximated using the width at the center of the top row, using the equation below.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-52">
<span class="eqno">(130)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-52" title="Permalink to this equation">¶</a></span>\[A_{LFOM,toprow} = y(h_{d,max} - 0.5 S_{LFOM,rows}) S_{LFOM,rows}\]</div>
<p>It is assumed that the top row will only have one circular orifice therefore the maximum diameter of the orifice can be calculated solving for the diameter that equals the area found above.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-53">
<span class="eqno">(131)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-53" title="Permalink to this equation">¶</a></span>\[D_{LFOM,toprow,max} = 2 \sqrt{\frac{A_{LFOM, toprow}}{\pi}}\]</div>
<p>The diameter of the LFOM orifice, <span class="math notranslate nohighlight">\(D_{LFOM, or}\)</span>, is then the minimum of <span class="math notranslate nohighlight">\(D_{LFOM,toprow,max}\)</span> and <span class="math notranslate nohighlight">\(D_{LFOM, or, max}\)</span> rounded to the nearest drill bit size available.  Using the maximum possible diameter size reduces the number of orifices needed. The area of flow from each LFOM orifice is <span class="math notranslate nohighlight">\(A_{LFOM,or} = \Pi_{VC}\pi \frac{D_{LFOM, or}}{2}^2\)</span>. The radius of the orifice or the height difference from the bottom of the orifice to the center is <span class="math notranslate nohighlight">\(H_{LFOM,or,center} = \frac{D_{LFOM, or}}{2}\)</span>. The max number of orifices per row (i.e. the number of orifice in the bottom row) is <span class="math notranslate nohighlight">\(N_{or, row, max} = \frac{\pi D_{LFOM, min}}{D_{LFOM,or} +S_{or}} `, where :math:`S_{or}\)</span>, is the spacing of orifices to maintain structural integrity of the PVC, and then <span class="math notranslate nohighlight">\(N_{or, row, max}\)</span> will be rounded down to the next integer because there has to be an integer number of orifices.</p>
<p>The number of orifices in each row and the flow through each row is a iterative process that is shown below.</p>
<p>A sample LFOM will be derived based on the above calculation</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">aguaclara.core.constants</span> <span class="k">as</span> <span class="nn">con</span>
<span class="kn">import</span> <span class="nn">aguaclara.core.physchem</span> <span class="k">as</span> <span class="nn">pc</span>
<span class="kn">import</span> <span class="nn">aguaclara.core.pipes</span> <span class="k">as</span> <span class="nn">pipe</span>
<span class="kn">import</span> <span class="nn">aguaclara.core.utility</span> <span class="k">as</span> <span class="nn">ut</span>
<span class="kn">import</span> <span class="nn">aguaclara.core.drills</span> <span class="k">as</span> <span class="nn">drills</span>
<span class="kn">from</span> <span class="nn">aguaclara.core.units</span> <span class="k">import</span> <span class="n">unit_registry</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">#expert input</span>
<span class="n">Q_plant</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">L</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span> <span class="c1">#sample value</span>
<span class="n">h_d_max</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="c1">#sample value</span>
<span class="n">f_s</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="c1">#expert input</span>
<span class="n">SDR</span> <span class="o">=</span> <span class="mi">26</span>
<span class="n">drill_bit_avail</span> <span class="o">=</span> <span class="n">drills</span><span class="o">.</span><span class="n">DRILL_BITS_D_IMPERIAL</span>
<span class="n">s_or</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span>

<span class="k">def</span> <span class="nf">width_stout_weir</span><span class="p">(</span><span class="n">Q_plant</span><span class="p">,</span><span class="n">h_d_max</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
  <span class="n">width</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Q_plant</span> <span class="o">/</span> <span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">VC_ORIFICE_RATIO</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">h_d_max</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pc</span><span class="o">.</span><span class="n">gravity</span> <span class="o">*</span> <span class="n">z</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">width</span>

<span class="n">A_LFOM</span> <span class="o">=</span> <span class="n">f_s</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">Q_plant</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pc</span><span class="o">.</span><span class="n">gravity</span> <span class="o">*</span> <span class="n">h_d_max</span><span class="p">))</span>
<span class="n">ND_LFOM</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">ND_SDR_available</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">diam_circle</span><span class="p">(</span><span class="n">A_LFOM</span><span class="p">),</span><span class="n">SDR</span><span class="p">)</span>
<span class="n">S_LFOM_rows</span> <span class="o">=</span> <span class="n">h_d_max</span> <span class="o">/</span> <span class="n">n_rows</span>
<span class="n">A_LFOM_toprow</span> <span class="o">=</span> <span class="n">S_LFOM_rows</span> <span class="o">*</span> <span class="n">width_stout_weir</span><span class="p">(</span><span class="n">Q_plant</span><span class="p">,</span><span class="n">h_d_max</span><span class="p">,(</span><span class="n">h_d_max</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">S_LFOM_rows</span><span class="p">))</span>
<span class="n">D_LFOM_or_max</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">diam_circle</span><span class="p">(</span><span class="n">A_LFOM_toprow</span><span class="p">)</span>
<span class="n">D_LFOM_or</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">floor_nearest</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">S_LFOM_rows</span><span class="p">,</span><span class="n">D_LFOM_or_max</span><span class="p">),</span><span class="n">drill_bit_avail</span><span class="p">)</span>
<span class="n">A_LFOM_or</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">area_circle</span><span class="p">(</span><span class="n">D_LFOM_or</span><span class="p">)</span>
<span class="n">H_or_center</span> <span class="o">=</span> <span class="n">D_LFOM_or</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">N_or_row_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ND_LFOM</span> <span class="o">/</span> <span class="p">(</span><span class="n">D_LFOM_or</span> <span class="o">+</span> <span class="n">s_or</span><span class="p">))</span>
</pre></div>
</div>
<p>For a stout weir, there is a linear relationship between height and flow rate, therefore the goal flow rate linearly from <span class="math notranslate nohighlight">\(\frac{Q_{plant}}{N_{rows}}\)</span> to <span class="math notranslate nohighlight">\(Q_{ plant}\)</span>.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flow_goal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">)</span> <span class="o">*</span> <span class="n">Q_plant</span>
</pre></div>
</div>
<p>Next, we need to determine the height of the center of each row, we will assume that when <span class="math notranslate nohighlight">\(x=0\)</span> the flow rate should also equal zero.</p>
<div class="math notranslate nohighlight" id="equation-flow-control-and-measurement-fcm-derivations-54">
<span class="eqno">(132)<a class="headerlink" href="#equation-flow-control-and-measurement-fcm-derivations-54" title="Permalink to this equation">¶</a></span>\[H_{row,i} = i S_{LFOM,rows} + H_{LFOM,or,center}\]</div>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">H_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">n_rows</span><span class="p">)</span> <span class="o">*</span> <span class="n">S_LFOM_rows</span> <span class="o">+</span> <span class="n">H_or_center</span>
</pre></div>
</div>
<p>Now that we have these two values we have to iterate through the height of the LFOM to get the correct flow through each row.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flow_current</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">L</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>
<span class="n">N_or_actual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span>
<span class="n">error_per_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
  <span class="n">flow_needed</span> <span class="o">=</span> <span class="n">flow_goal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">flow_current</span>
  <span class="n">flow_per_orifice</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">flow_orifice_vert</span><span class="p">(</span><span class="n">D_LFOM_or</span><span class="p">,</span><span class="n">H_row</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">con</span><span class="o">.</span><span class="n">VC_ORIFICE_RATIO</span><span class="p">)</span>
  <span class="n">N_or</span> <span class="o">=</span> <span class="p">(</span><span class="n">flow_needed</span><span class="o">/</span><span class="n">flow_per_orifice</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">)</span>
  <span class="n">N_or_actual</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">N_or</span><span class="p">)),</span><span class="n">N_or_row_max</span><span class="p">)</span>
  <span class="n">flow_current</span> <span class="o">=</span> <span class="n">flow_current</span> <span class="o">+</span> <span class="n">flow_per_orifice</span> <span class="o">*</span> <span class="n">N_or_actual</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
  <span class="n">error_per_row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="o">*</span> <span class="p">(</span><span class="n">flow_current</span> <span class="o">-</span> <span class="n">flow_goal</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">flow_goal</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="FCM_Solution.html" class="btn btn-neutral float-right" title="Flow Control and Measurement Solution" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="FCM_Design.html" class="btn btn-neutral" title="Flow Control and Measurement Design" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, AguaClara Cornell.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/mathjax_config.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>